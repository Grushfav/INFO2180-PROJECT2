<?php
require_once 'config.php';

// Check if user is logged in
if (!isset($_SESSION['user_id'])) {
    header('Location: login.php');
    exit();
}
?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Dolphin CRM</title>
    <link rel="stylesheet" href="css/style.css?v=<?php echo time() . '-' . mt_rand(); ?>">
</head>
<body>
    <div class="app-wrapper">
        <!-- Sidebar Navigation -->
        <nav class="sidebar-nav">
            <div class="sidebar-nav-header">
                <h1>ğŸ¬ Dolphin CRM</h1>
            </div>
            <ul>
                <li><a href="#" onclick="loadPage('home'); return false;" class="nav-link active" data-page="home">ğŸ“Š Dashboard</a></li>
                <li><a href="#" onclick="loadPage('contacts'); return false;" class="nav-link" data-page="contacts">ğŸ“‹ Contacts</a></li>
                <li><a href="#" onclick="loadPage('users'); return false;" class="nav-link" data-page="users">ğŸ‘¥ Users</a></li>
                <li><a href="logout.php" class="nav-link logout">ğŸšª Logout</a></li>
            </ul>
        </nav>

        <!-- Main Content Area -->
        <div class="main-content">
            <div id="content-area" class="page-wrapper">
                <!-- Dynamic content loads here -->
                <p class="loading-message">Loading...</p>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
           
            loadPage('home');

            
            window.addEventListener('popstate', function(event) {
                if (event.state && event.state.page) {
                    loadPageContent(event.state.page, false);
                }
            });
        });

        function loadPage(page) {
            
            $('.nav-link').removeClass('active');
            $('[data-page="' + page + '"]').addClass('active');

           
            loadPageContent(page, true);
        }

        function loadPageContent(page, pushState = true) {
            let contentUrl = '';
            
           
            switch(page) {
                case 'home':
                    contentUrl = 'pages/home-content.php';
                    break;
                case 'contacts':
                    contentUrl = 'pages/contacts-content.php';
                    break;
                case 'users':
                    contentUrl = 'pages/users-content.php';
                    break;
                default:
                    contentUrl = 'pages/home-content.php';
            }

            $.ajax({
                url: contentUrl,
                method: 'GET',
                dataType: 'html',
                success: function(html) {
                    $('#content-area').html(html);
                    
                  
                    if (pushState) {
                        window.history.pushState({page: page}, page, '#' + page);
                    }
                },
                error: function(xhr) {
                    $('#content-area').html('<div class="page-load-error">Error loading page content</div>');
                }
            });
        }
    </script>
</body>
</html>










